  ##
  ## Scripts to perform "monitor" scanning and restarting
  ## Source:
  ##
  
  scan_bt_depart:
      sequence:
      - wait_template: "{{ is_state('script.scan_bt_arrive', 'off') }}"
      - delay: '00:00:30'
      - service: mqtt.publish
        data:
          topic: presence/scan/depart
          payload: ''
      - delay: '00:00:35'
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.home_count
          state: "0"
      - service: mqtt.publish
        data:
          topic: presence/scan/depart
          payload: ''
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.home_count
          state: "0"
      - delay: '00:01:05'
      - service: mqtt.publish
        data:
          topic: presence/scan/depart
          payload: ''

  scan_bt_arrive:
      sequence:
      - wait_template: "{{ is_state('script.scan_bt_depart', 'off') }}"
      - service: mqtt.publish
        data:
          topic: presence/scan/arrive
          payload: ''
      - delay: '00:00:15'
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.home_count
          state: "1"
      - service: mqtt.publish
        data:
          topic: presence/scan/arrive
          payload: ''
      - delay: '00:00:15'
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.home_count
          state: "1"
      - service: mqtt.publish
        data:
          topic: presence/scan/arrive
          payload: ''


  scan_bt_restart:
    sequence:
    - service: mqtt.publish
      data:
        topic: presence/scan/restart
        payload: ''