##
## Covers all automations corresponding the "monitor"-RPi Zero on the ground floor
##

## If he's offline for 10 minutes, hard reset him
- initial_state: on
  alias: "Presence - BT ground offline too long"
  trigger:
    - platform: state
      entity_id: binary_sensor.monitor_ground
      to: "off"
      for: "00:10:00"
  action:
    - service: switch.turn_off
      entity_id: switch.monitor_ground
    - delay: "00:01:00"
    - service: switch.turn_on
      entity_id: switch.monitor_ground
    - wait_template: >-
        {{ is_state('binary_sensor.monitor_ground','on') }}
    - service: notify.mobile_app_fabi_phone
      data:
        message: "Ground Bluetooth Knoten wurde neu gestartet!"

## If he's offline for 30 seconds, announce that he cannot be trusted
- initial_state: on
  alias: "Presence - BT ground offline"
  trigger:
    - platform: state
      entity_id: binary_sensor.monitor_ground
      to: "off"
      for: "00:00:30"
  action:
    - service: mqtt.publish
      data:
        topic: monitor/ground/partner_phone/device_tracker
        payload: unknown
    - service: mqtt.publish
      data:
        topic: monitor/ground/fabi_phone/device_tracker
        payload: unknown
    - service: mqtt.publish
      data:
        topic: monitor/ground/fabi_watch/device_tracker
        payload: unknown
    - service: mqtt.publish
      data:
        topic: monitor/ground/mate_phone/device_tracker
        payload: unknown
